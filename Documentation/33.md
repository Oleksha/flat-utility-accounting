## –î–µ–ª–∞–µ–º –æ–±—â–∏–π –¥–∞—à–±–æ—Ä–¥ –ø–æ –≤—Å–µ–º –∫–≤–∞—Ä—Ç–∏—Ä–∞–º

–û—Ç–ª–∏—á–Ω–æ üëç

–î–µ–ª–∞–µ–º **–æ–±—â–∏–π –¥–∞—à–±–æ—Ä–¥ –ø–æ –≤—Å–µ–º –∫–≤–∞—Ä—Ç–∏—Ä–∞–º** ‚Äî —ç—Ç–æ –ª–æ–≥–∏—á–Ω—ã–π –∏ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π —à–∞–≥.

–Ø —Å–¥–µ–ª–∞—é **–ø–æ–Ω—è—Ç–Ω—É—é, ‚Äú–±–∞–Ω–∫–æ–≤—Å–∫—É—é‚Äù —Å–≤–æ–¥–∫—É**, –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞.

---

## üéØ –ß—Ç–æ –±—É–¥–µ—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ (`/`)

### üîπ –ü–æ –∫–∞–∂–¥–æ–π –∫–≤–∞—Ä—Ç–∏—Ä–µ:

* –∞–¥—Ä–µ—Å / –Ω–∞–∑–≤–∞–Ω–∏–µ
* **–Ω–∞—á–∏—Å–ª–µ–Ω–æ –∑–∞ –≥–æ–¥**
* **–æ–ø–ª–∞—á–µ–Ω–æ –∑–∞ –≥–æ–¥**
* **–¥–æ–ª–≥ / –ø–µ—Ä–µ–ø–ª–∞—Ç–∞**
* –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è vs –ø–ª–∞—Ç–µ–∂–∏)
* –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å¬ª

### üîπ –°–≤–µ—Ä—Ö—É:

* –≤—ã–±–æ—Ä –≥–æ–¥–∞
* –æ–±—â–∏–π –∏—Ç–æ–≥ –ø–æ –≤—Å–µ–º –∫–≤–∞—Ä—Ç–∏—Ä–∞–º

---

# ‚úÖ –®–ê–ì 1. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä DashboardController

`app/Http/Controllers/DashboardController.php`

```php
<?php

namespace App\Http\Controllers;

use App\Models\Apartment;
use Illuminate\Http\Request;

class DashboardController extends Controller
{
    public function index(Request $request)
    {
        $year = (int) $request->get('year', now()->year);

        $apartments = Apartment::with(['charges', 'payments'])->get();

        $totalChargesAll = 0;
        $totalPaymentsAll = 0;

        foreach ($apartments as $apartment) {

            $charges = $apartment->charges
                ->filter(fn($c) => $c->period->year == $year);

            $payments = $apartment->payments
                ->filter(fn($p) => $p->payment_date->year == $year);

            $apartment->totalCharges = $charges->sum('amount');
            $apartment->totalPayments = $payments->sum('amount');
            $apartment->debt = $apartment->totalCharges - $apartment->totalPayments;

            $totalChargesAll += $apartment->totalCharges;
            $totalPaymentsAll += $apartment->totalPayments;

            // –¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫–∞
            $months = collect(range(1, 12))
                ->map(fn($m) => sprintf('%02d', $m))
                ->map(fn($m) => "$year-$m");

            $chargesByMonth = $charges
                ->groupBy(fn($c) => $c->period->format('Y-m'));

            $paymentsByMonth = $payments
                ->groupBy(fn($p) => $p->payment_date->format('Y-m'));

            $apartment->chartLabels = $months
                ->map(fn($m) => \Carbon\Carbon::createFromFormat('Y-m', $m)->translatedFormat('M'))
                ->toArray();

            $apartment->chartCharges = $months
                ->map(fn($m) => ($chargesByMonth[$m] ?? collect())->sum('amount'))
                ->toArray();

            $apartment->chartPayments = $months
                ->map(fn($m) => ($paymentsByMonth[$m] ?? collect())->sum('amount'))
                ->toArray();
        }

        $totalDebtAll = $totalChargesAll - $totalPaymentsAll;

        return view('dashboard', compact(
            'apartments',
            'year',
            'totalChargesAll',
            'totalPaymentsAll',
            'totalDebtAll'
        ));
    }
}
```

---

# ‚úÖ –®–ê–ì 2. –ú–∞—Ä—à—Ä—É—Ç

`routes/web.php`

```php
Route::get('/', [DashboardController::class, 'index'])->name('dashboard');
```

---

# ‚úÖ –®–ê–ì 3. –®–∞–±–ª–æ–Ω –¥–∞—à–±–æ—Ä–¥–∞

`resources/views/dashboard.blade.php`

```blade
@extends('layouts.app')

@section('content')
<div class="container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>–î–∞—à–±–æ—Ä–¥ –∫–≤–∞—Ä—Ç–∏—Ä ‚Äî {{ $year }}</h2>

        <form method="GET">
            <select name="year" class="form-select" onchange="this.form.submit()">
                @for($y = now()->year; $y >= now()->year - 5; $y--)
                    <option value="{{ $y }}" {{ $y == $year ? 'selected' : '' }}>
                        {{ $y }}
                    </option>
                @endfor
            </select>
        </form>
    </div>

    {{-- –û–±—â–∏–µ –∏—Ç–æ–≥–∏ --}}
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="text-muted">–ù–∞—á–∏—Å–ª–µ–Ω–æ</div>
                    <div class="fs-4">{{ number_format($totalChargesAll, 2, ',', ' ') }} ‚ÇΩ</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="text-muted">–û–ø–ª–∞—á–µ–Ω–æ</div>
                    <div class="fs-4">{{ number_format($totalPaymentsAll, 2, ',', ' ') }} ‚ÇΩ</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card {{ $totalDebtAll > 0 ? 'border-danger' : 'border-success' }}">
                <div class="card-body">
                    <div class="text-muted">–ë–∞–ª–∞–Ω—Å</div>
                    <div class="fs-4 {{ $totalDebtAll > 0 ? 'text-danger' : 'text-success' }}">
                        {{ number_format($totalDebtAll, 2, ',', ' ') }} ‚ÇΩ
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä --}}
    <div class="row">
        @foreach($apartments as $apartment)
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-body">
                        <h5>{{ $apartment->name }}</h5>
                        <p class="text-muted">{{ $apartment->address }}</p>

                        <div class="mb-2">
                            –ù–∞—á–∏—Å–ª–µ–Ω–æ: <strong>{{ number_format($apartment->totalCharges, 2, ',', ' ') }} ‚ÇΩ</strong><br>
                            –û–ø–ª–∞—á–µ–Ω–æ: <strong>{{ number_format($apartment->totalPayments, 2, ',', ' ') }} ‚ÇΩ</strong><br>
                            –ë–∞–ª–∞–Ω—Å:
                            <strong class="{{ $apartment->debt > 0 ? 'text-danger' : 'text-success' }}">
                                {{ number_format($apartment->debt, 2, ',', ' ') }} ‚ÇΩ
                            </strong>
                        </div>

                        <canvas id="chart-{{ $apartment->id }}" height="90"></canvas>
                    </div>

                    <div class="card-footer text-end">
                        <a href="{{ route('apartments.show', $apartment) }}" class="btn btn-primary btn-sm">
                            –û—Ç–∫—Ä—ã—Ç—å ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        @endforeach
    </div>

</div>
@endsection

@push('scripts')
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {

    @foreach($apartments as $apartment)
        new Chart(
            document.getElementById('chart-{{ $apartment->id }}'),
            {
                type: 'line',
                data: {
                    labels: @json($apartment->chartLabels),
                    datasets: [
                        {
                            label: '–ù–∞—á–∏—Å–ª–µ–Ω–∏—è',
                            data: @json($apartment->chartCharges),
                            borderWidth: 2,
                            tension: 0.3
                        },
                        {
                            label: '–ü–ª–∞—Ç–µ–∂–∏',
                            data: @json($apartment->chartPayments),
                            borderWidth: 2,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    plugins: {
                        legend: { display: false }
                    }
                }
            }
        );
    @endforeach

});
</script>
@endpush
```

---

# üéâ –ò—Ç–æ–≥

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è:

‚úî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥**
‚úî —Å–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –∫–≤–∞—Ä—Ç–∏—Ä–∞–º
‚úî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ–ª–≥–æ–≤
‚úî –±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –∫–≤–∞—Ä—Ç–∏—Ä—É
‚úî –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π UI

---

## üîú –ö—É–¥–∞ –¥–∞–ª—å—à–µ (–æ—á–µ–Ω—å –ª–æ–≥–∏—á–Ω–æ)

1Ô∏è‚É£ **–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–∞ –∑–∞ –≥–æ–¥ (PDF / Excel)**
2Ô∏è‚É£ **–î–æ–ª–≥–∏ –ø–æ —É—Å–ª—É–≥–∞–º (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)**
3Ô∏è‚É£ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + —Ä–æ–ª–∏**
4Ô∏è‚É£ **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è / —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**

–í—ã–±–∏—Ä–∞–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –ø—Ä–æ–µ–∫—Ç —É–∂–µ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç üí™

---

[–ü—Ä–µ–¥—ã–¥—É—â–∞—è —á–∞—Å—Ç—å](32.md) | [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](01.md) | [–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å](34.md)



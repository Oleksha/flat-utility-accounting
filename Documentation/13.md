## Добавим кнопки “Добавить начисление” и “Добавить платеж”

Хочу.

Отлично! Давай добавим **кнопки “Добавить начисление” и “Добавить платеж” прямо на странице квартиры** и сделаем формы в модальных окнах Bootstrap, чтобы не уходить со страницы.

---

# **1. Обновляем `apartments/show.blade.php`**

```blade
@extends('layouts.app')

@section('content')
<h1>Квартира: {{ $apartment->name }}</h1>
<p><strong>Адрес:</strong> {{ $apartment->address }}</p>

<!-- Баланс -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3">
            <div class="card-header">Баланс</div>
            <div class="card-body">
                <h3 class="card-title">
                    {{ $apartment->charges->sum('amount') - $apartment->payments->sum('amount') }} ₽
                </h3>
                <p class="card-text">Начисления минус платежи</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                Начисления
                <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#addChargeModal">+</button>
            </div>
            <div class="card-body">
                <h3 class="card-title">{{ $apartment->charges->sum('amount') }} ₽</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-warning mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                Платежи
                <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#addPaymentModal">+</button>
            </div>
            <div class="card-body">
                <h3 class="card-title">{{ $apartment->payments->sum('amount') }} ₽</h3>
            </div>
        </div>
    </div>
</div>

<!-- Начисления -->
<h3>Начисления</h3>
<table class="table table-sm table-striped mb-4">
    <thead class="table-dark">
        <tr>
            <th>Услуга</th>
            <th>Сумма</th>
            <th>Период</th>
            <th>Комментарий</th>
        </tr>
    </thead>
    <tbody>
        @foreach($apartment->charges as $charge)
        <tr>
            <td>{{ $charge->service->name }}</td>
            <td>{{ $charge->amount }} ₽</td>
            <td>{{ $charge->period->format('m.Y') }}</td>
            <td>{{ $charge->comment }}</td>
        </tr>
        @endforeach
    </tbody>
</table>

<!-- Платежи -->
<h3>Платежи</h3>
<table class="table table-sm table-striped">
    <thead class="table-dark">
        <tr>
            <th>Сумма</th>
            <th>Дата</th>
            <th>Комментарий</th>
        </tr>
    </thead>
    <tbody>
        @foreach($apartment->payments as $payment)
        <tr>
            <td>{{ $payment->amount }} ₽</td>
            <td>{{ $payment->payment_date->format('d.m.Y') }}</td>
            <td>{{ $payment->comment }}</td>
        </tr>
        @endforeach
    </tbody>
</table>

<a class="btn btn-primary mt-3" href="{{ route('apartments.index') }}">Назад</a>

<!-- Модальное окно для начисления -->
<div class="modal fade" id="addChargeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="{{ route('charges.store') }}" method="POST">
                @csrf
                <input type="hidden" name="apartment_id" value="{{ $apartment->id }}">
                <div class="modal-header">
                    <h5 class="modal-title">Добавить начисление</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Услуга</label>
                        <select name="service_id" class="form-select" required>
                            @foreach(\App\Models\Service::all() as $service)
                            <option value="{{ $service->id }}">{{ $service->name }}</option>
                            @endforeach
                        </select>
                    </div>
                    <div class="mb-3">
                        <label>Сумма</label>
                        <input type="number" name="amount" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Период</label>
                        <input type="month" name="period" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Комментарий</label>
                        <input type="text" name="comment" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" type="submit">Сохранить</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Модальное окно для платежа -->
<div class="modal fade" id="addPaymentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="{{ route('payments.store') }}" method="POST">
                @csrf
                <input type="hidden" name="apartment_id" value="{{ $apartment->id }}">
                <div class="modal-header">
                    <h5 class="modal-title">Добавить платеж</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label>Сумма</label>
                        <input type="number" name="amount" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Дата</label>
                        <input type="date" name="payment_date" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Комментарий</label>
                        <input type="text" name="comment" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" type="submit">Сохранить</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                </div>
            </form>
        </div>
    </div>
</div>
@endsection
```

---

# **2. Что мы получили**

* На карточках **Начисления** и **Платежи** появились кнопки `+`, которые открывают модальные окна.
* Все действия выполняются **не покидая страницу квартиры**.
* Удобный ввод данных: сумма, дата/период, комментарий.
* После добавления начисления или платежа страница обновляется и баланс пересчитывается.

---

Если хочешь, я могу **сделать автоматический пересчет баланса и визуализацию с цветовой индикацией (например, красный, если долг, зелёный, если положительный)** прямо на карточке баланса.

Хочешь, чтобы я это сделал?

---

[Предыдущая часть](12.md) | [Содержание](01.md) | [Следующая часть](14.md)



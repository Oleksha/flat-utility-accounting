## **–£–ª—É—á—à–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**

–î–µ–ª–∞–µ–º –µ—â—ë –ª—É—á—à–µ:
* –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∫–ª–∞–¥–∫—É ‚Äú–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏‚Äù –ø—Ä—è–º–æ –≤ Modal –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
* —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å PDF –ø—Ä—è–º–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π

–û—Ç–ª–∏—á–Ω–æ üòé
–î–µ–ª–∞–µ–º **—É–¥–æ–±–Ω—ã–π, ‚Äú–≤–∑—Ä–æ—Å–ª—ã–π‚Äù UX**:
üëâ **–ø—Ä–æ—Å–º–æ—Ç—Ä / —É–¥–∞–ª–µ–Ω–∏–µ / –∑–∞–º–µ–Ω–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π –ø—Ä—è–º–æ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è**, –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

–ù–∏–∂–µ ‚Äî **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ**, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º.

---

# üéØ –ß—Ç–æ –≤ –∏—Ç–æ–≥–µ –±—É–¥–µ—Ç

–í —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π:

* –∫–Ω–æ–ø–∫–∞ **üìÑ –ö–≤–∏—Ç–∞–Ω—Ü–∏–∏**
* –ø—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è **Bootstrap modal**
* –≤–Ω—É—Ç—Ä–∏:

    * —Å–ø–∏—Å–æ–∫ PDF
    * –æ—Ç–∫—Ä—ã—Ç—å / —Å–∫–∞—á–∞—Ç—å
    * —É–¥–∞–ª–∏—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é
    * (–ø–æ–∑–∂–µ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ–Ω—É)

---

# 1Ô∏è‚É£ –ö–Ω–æ–ø–∫–∞ ¬´–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏¬ª –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π

üìÑ `apartments/partials/charges-table.blade.php`

```blade
<td class="text-center">
    @if($charge->receipts->isNotEmpty())
        <button class="btn btn-sm btn-outline-primary"
                data-bs-toggle="modal"
                data-bs-target="#receiptsModal-{{ $charge->id }}">
            üìÑ {{ $charge->receipts->count() }}
        </button>
    @else
        <span class="text-muted">‚Äî</span>
    @endif
</td>
```

---

# 2Ô∏è‚É£ Modal –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

üëâ **–î–∞, modal –Ω–∞ –∫–∞–∂–¥–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ**, –∏—Ö –Ω–µ–º–Ω–æ–≥–æ.

–°—Ä–∞–∑—É **–ø–æ—Å–ª–µ —Ç–∞–±–ª–∏—Ü—ã**:

```blade
@foreach($charges as $charge)
<div class="modal fade"
     id="receiptsModal-{{ $charge->id }}"
     tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">
                    –ö–≤–∏—Ç–∞–Ω—Ü–∏–∏ ‚Äî {{ $charge->service->name }}
                    ({{ $charge->period->translatedFormat('F Y') }})
                </h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                @if($charge->receipts->isEmpty())
                    <div class="alert alert-secondary mb-0">
                        –ö–≤–∏—Ç–∞–Ω—Ü–∏–π –Ω–µ—Ç
                    </div>
                @else
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>–§–∞–π–ª</th>
                                <th>–ü–µ—Ä–∏–æ–¥</th>
                                <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach($charge->receipts as $receipt)
                                <tr>
                                    <td>
                                        üìÑ {{ $receipt->original_name ?? '–ö–≤–∏—Ç–∞–Ω—Ü–∏—è.pdf' }}
                                    </td>
                                    <td>
                                        {{ $receipt->period->format('m.Y') }}
                                    </td>
                                    <td class="text-end">

                                        <a href="{{ route('receipts.download', $receipt) }}"
                                           target="_blank"
                                           class="btn btn-sm btn-outline-primary">
                                            –û—Ç–∫—Ä—ã—Ç—å
                                        </a>

                                        <form method="POST"
                                              action="{{ route('receipts.destroy', $receipt) }}"
                                              class="d-inline"
                                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é?')">
                                            @csrf
                                            @method('DELETE')

                                            <button class="btn btn-sm btn-outline-danger">
                                                üóë
                                            </button>
                                        </form>

                                    </td>
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                @endif

            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary"
                        data-bs-dismiss="modal">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>

        </div>
    </div>
</div>
@endforeach
```

---

# 3Ô∏è‚É£ –í–ê–ñ–ù–û: eager loading (–∏–Ω–∞—á–µ –±—É–¥–µ—Ç N+1)

–í `ApartmentController@show`:

```php
$charges = $apartment->charges()
    ->with(['service', 'receipts'])
    ->whereYear('period', $year)
    ->orderBy('period')
    ->get();
```

‚ö†Ô∏è **–ë–µ–∑ `with('receipts')` –±—É–¥–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å.**

---

# 4Ô∏è‚É£ –†–æ—É—Ç—ã (–ø—Ä–æ–≤–µ—Ä–∏–º)

```php
Route::post('/receipts', [ReceiptController::class, 'store'])
    ->name('receipts.store');

Route::delete('/receipts/{receipt}', [ReceiptController::class, 'destroy'])
    ->name('receipts.destroy');

Route::get('/receipts/{receipt}/download', [ReceiptController::class, 'download'])
    ->name('receipts.download');
```

---

# üéâ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å

‚úî –∏–∑ –∫–∞–∂–¥–æ–π —É—Å–ª—É–≥–∏ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é
‚úî –µ—Å–ª–∏ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Äî –≤—Å–µ –≤–∏–¥–Ω—ã
‚úî —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä—è–º–æ –∏–∑ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
‚úî –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
‚úî UX –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±–∏–ª–ª–∏–Ω–≥–µ

---

# üîú –û—á–µ–Ω—å –ª–æ–≥–∏—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

1Ô∏è‚É£ **–ó–∞–º–µ–Ω–∞ PDF** (upload –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞—Ä–æ–π)
2Ô∏è‚É£ **–ü–æ–∫–∞–∑ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ —Å—Ä–∞–∑—É –≤–Ω—É—Ç—Ä–∏ modal (iframe)**
3Ô∏è‚É£ **–ü–æ–¥—Å–≤–µ—Ç–∫–∞ —É—Å–ª—É–≥ –±–µ–∑ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π**
4Ô∏è‚É£ **–û—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ ‚Äú–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏‚Äù –ø–æ –∫–≤–∞—Ä—Ç–∏—Ä–µ**

üëâ –ü—Ä–µ–¥–ª–∞–≥–∞—é –¥–∞–ª—å—à–µ —Å–¥–µ–ª–∞—Ç—å **–ø.2 (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä PDF –ø—Ä—è–º–æ –≤ modal)** ‚Äî —ç—Ç–æ –ø—Ä—è–º üî• –¥–ª—è UX.
–•–æ—á–µ—à—å ‚Äî –¥–µ–ª–∞–µ–º.

---

[–ü—Ä–µ–¥—ã–¥—É—â–∞—è —á–∞—Å—Ç—å](50.md) | [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](01.md) | [–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å](52.md)



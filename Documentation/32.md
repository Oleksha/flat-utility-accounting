## –î–µ–ª–∞–µ–º —Ñ–æ—Ä–º—ã –ø–ª–∞—Ç–µ–∂–µ–π (Payments)

–û—Ç–ª–∏—á–Ω–æ üëç

–¢–æ–≥–¥–∞ –¥–µ–ª–∞–µ–º **—Ñ–æ—Ä–º—ã –ø–ª–∞—Ç–µ–∂–µ–π (Payments) ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**, –≤ —Ç–æ–º –∂–µ —Å—Ç–∏–ª–µ, —á—Ç–æ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è. –í—Å—ë –±—É–¥–µ—Ç **–µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –∏ –±–µ–∑ —Å—é—Ä–ø—Ä–∏–∑–æ–≤**.

---

## üéØ –ß—Ç–æ –≤ –∏—Ç–æ–≥–µ

* —Ñ–æ—Ä–º–∞ **–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞**
* —Ñ–æ—Ä–º–∞ **—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞**
* –≤—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
* –≤—ã–±–æ—Ä —É—Å–ª—É–≥–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
* –¥–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞
* —Å—É–º–º–∞
* –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–≤–∞—Ä—Ç–∏—Ä—ã

---

# ‚úÖ –®–ê–ì 1. –ú–∞—Ä—à—Ä—É—Ç—ã

–ï—Å–ª–∏ –µ—â—ë –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤—å –≤ `routes/web.php`:

```php
Route::resource('payments', PaymentController::class);
```

---

# ‚úÖ –®–ê–ì 2. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä PaymentController

–°–æ–∑–¥–∞–π:

```bash
php artisan make:controller PaymentController --resource
```

–ò –≤—Å—Ç–∞–≤—å –∫–æ–¥:

```php
<?php

namespace App\Http\Controllers;

use App\Models\Payment;
use App\Models\Apartment;
use App\Models\Service;
use Illuminate\Http\Request;

class PaymentController extends Controller
{
    public function create(Request $request)
    {
        return view('payments.create', [
            'payment'    => new Payment(),
            'apartments' => Apartment::all(),
            'services'   => Service::all(),
            'apartmentId'=> $request->get('apartment_id'),
        ]);
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'service_id'   => 'nullable|exists:services,id',
            'payment_date' => 'required|date',
            'amount'       => 'required|numeric|min:0',
            'comment'      => 'nullable|string|max:255',
        ]);

        Payment::create($data);

        return redirect()
            ->route('apartments.show', $data['apartment_id'])
            ->with('success', '–ü–ª–∞—Ç—ë–∂ –¥–æ–±–∞–≤–ª–µ–Ω');
    }

    public function edit(Payment $payment)
    {
        return view('payments.edit', [
            'payment'    => $payment,
            'apartments' => Apartment::all(),
            'services'   => Service::all(),
        ]);
    }

    public function update(Request $request, Payment $payment)
    {
        $data = $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'service_id'   => 'nullable|exists:services,id',
            'payment_date' => 'required|date',
            'amount'       => 'required|numeric|min:0',
            'comment'      => 'nullable|string|max:255',
        ]);

        $payment->update($data);

        return redirect()
            ->route('apartments.show', $data['apartment_id'])
            ->with('success', '–ü–ª–∞—Ç—ë–∂ –æ–±–Ω–æ–≤–ª—ë–Ω');
    }

    public function destroy(Payment $payment)
    {
        $apartmentId = $payment->apartment_id;
        $payment->delete();

        return redirect()
            ->route('apartments.show', $apartmentId)
            ->with('success', '–ü–ª–∞—Ç—ë–∂ —É–¥–∞–ª—ë–Ω');
    }
}
```

---

# ‚úÖ –®–ê–ì 3. –û–±—â–∞—è —Ñ–æ—Ä–º–∞ –ø–ª–∞—Ç–µ–∂–∞

–°–æ–∑–¥–∞–π partial:

`resources/views/payments/_form.blade.php`

```blade
<div class="row">
    <div class="col-md-8 offset-md-2">

        {{-- –ö–≤–∞—Ä—Ç–∏—Ä–∞ --}}
        <div class="mb-3">
            <label class="form-label">–ö–≤–∞—Ä—Ç–∏—Ä–∞</label>
            <select name="apartment_id" class="form-select" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                @foreach($apartments as $apartment)
                    <option value="{{ $apartment->id }}"
                        {{ old('apartment_id', $apartmentId ?? $payment->apartment_id) == $apartment->id ? 'selected' : '' }}>
                        {{ $apartment->name }} ‚Äî {{ $apartment->address }}
                    </option>
                @endforeach
            </select>
        </div>

        {{-- –£—Å–ª—É–≥–∞ --}}
        <div class="mb-3">
            <label class="form-label">–£—Å–ª—É–≥–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <select name="service_id" class="form-select">
                <option value="">‚Äî</option>
                @foreach($services as $service)
                    <option value="{{ $service->id }}"
                        {{ old('service_id', $payment->service_id) == $service->id ? 'selected' : '' }}>
                        {{ $service->name }}
                    </option>
                @endforeach
            </select>
        </div>

        {{-- –î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞ --}}
        <div class="mb-3">
            <label class="form-label">–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞</label>
            <input type="date"
                   name="payment_date"
                   class="form-control"
                   value="{{ old('payment_date', optional($payment->payment_date)->format('Y-m-d')) }}"
                   required>
        </div>

        {{-- –°—É–º–º–∞ --}}
        <div class="mb-3">
            <label class="form-label">–°—É–º–º–∞</label>
            <input type="number"
                   step="0.01"
                   min="0"
                   name="amount"
                   class="form-control"
                   value="{{ old('amount', $payment->amount) }}"
                   required>
        </div>

        {{-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π --}}
        <div class="mb-3">
            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
            <textarea name="comment"
                      class="form-control"
                      rows="2">{{ old('comment', $payment->comment) }}</textarea>
        </div>

        <div class="text-end">
            <button class="btn btn-success">
                {{ $payment->exists ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂' }}
            </button>
        </div>

    </div>
</div>
```

---

# ‚úÖ –®–ê–ì 4. Create / Edit views

### `resources/views/payments/create.blade.php`

```blade
@extends('layouts.app')

@section('content')
<div class="container">
    <h2 class="mb-4">–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂</h2>

    <form method="POST" action="{{ route('payments.store') }}">
        @csrf
        @include('payments._form')
    </form>
</div>
@endsection
```

---

### `resources/views/payments/edit.blade.php`

```blade
@extends('layouts.app')

@section('content')
<div class="container">
    <h2 class="mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç—ë–∂</h2>

    <form method="POST" action="{{ route('payments.update', $payment) }}">
        @csrf
        @method('PUT')
        @include('payments._form')
    </form>
</div>
@endsection
```

---

# ‚úÖ –®–ê–ì 5. –ú–æ–¥–µ–ª—å Payment (–ø—Ä–æ–≤–µ—Ä–∫–∞)

```php
protected $fillable = [
    'apartment_id',
    'service_id',
    'payment_date',
    'amount',
    'comment',
];

protected $casts = [
    'payment_date' => 'date',
];
```

---

# üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å:

‚úî –ø–ª–∞—Ç–µ–∂–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è
‚úî —Ñ–æ—Ä–º—ã —É–¥–æ–±–Ω—ã–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ
‚úî –≤–æ–∑–≤—Ä–∞—Ç –∏–¥—ë—Ç –æ–±—Ä–∞—Ç–Ω–æ –∫ –∫–≤–∞—Ä—Ç–∏—Ä–µ
‚úî UX —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã –∑–∞–≤–µ—Ä—à—ë–Ω

---

## üîú –ß—Ç–æ –¥–∞–ª—å—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é

1Ô∏è‚É£ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –¥–æ–ª–≥–∞ –ø–æ –∫–∞–∂–¥–æ–π —É—Å–ª—É–≥–µ**
2Ô∏è‚É£ **–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–∞ –∑–∞ –≥–æ–¥ (PDF / Excel)**
3Ô∏è‚É£ **–î–∞—à–±–æ—Ä–¥ –ø–æ –≤—Å–µ–º –∫–≤–∞—Ä—Ç–∏—Ä–∞–º**
4Ô∏è‚É£ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –±—É–¥–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)**

–í—ã–±–∏—Ä–∞–π –Ω–æ–º–µ—Ä ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º üöÄ

---

[–ü—Ä–µ–¥—ã–¥—É—â–∞—è —á–∞—Å—Ç—å](31.md) | [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](01.md) | [–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å](33.md)



## Делаем CRUD для тарифов (Rates), начислений (Charges) и платежей (Payments)

Хочу.

Отлично! Давай сделаем **CRUD для тарифов (Rates), начислений (Charges) и платежей (Payments)** с удобным интерфейсом на Blade + Bootstrap. Я дам полный каркас с контроллерами, шаблонами и связями, чтобы веб-приложение стало полностью рабочим.

---

# **1. Rate (Тарифы)**

### **RateController**

```php
<?php

namespace App\Http\Controllers;

use App\Models\Rate;
use App\Models\Apartment;
use App\Models\Provider;
use App\Models\Service;
use Illuminate\Http\Request;

class RateController extends Controller
{
    public function index()
    {
        $rates = Rate::with(['apartment', 'provider', 'service'])->get();
        return view('rates.index', compact('rates'));
    }

    public function create()
    {
        $apartments = Apartment::all();
        $providers = Provider::all();
        $services = Service::all();
        return view('rates.create', compact('apartments', 'providers', 'services'));
    }

    public function store(Request $request)
    {
        $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'provider_id' => 'required|exists:providers,id',
            'service_id' => 'required|exists:services,id',
            'price' => 'required|numeric|min:0',
            'type' => 'required|in:fixed,metered',
            'start_date' => 'required|date',
        ]);

        Rate::create($request->all());
        return redirect()->route('rates.index')->with('success', 'Тариф добавлен');
    }

    public function show(Rate $rate)
    {
        return view('rates.show', compact('rate'));
    }

    public function edit(Rate $rate)
    {
        $apartments = Apartment::all();
        $providers = Provider::all();
        $services = Service::all();
        return view('rates.edit', compact('rate', 'apartments', 'providers', 'services'));
    }

    public function update(Request $request, Rate $rate)
    {
        $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'provider_id' => 'required|exists:providers,id',
            'service_id' => 'required|exists:services,id',
            'price' => 'required|numeric|min:0',
            'type' => 'required|in:fixed,metered',
            'start_date' => 'required|date',
        ]);

        $rate->update($request->all());
        return redirect()->route('rates.index')->with('success', 'Тариф обновлен');
    }

    public function destroy(Rate $rate)
    {
        $rate->delete();
        return redirect()->route('rates.index')->with('success', 'Тариф удален');
    }
}
```

---

### **Blade-шаблоны для Rates**

**`resources/views/rates/index.blade.php`**

```blade
@extends('layouts.app')

@section('content')
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Тарифы</h1>
    <a class="btn btn-primary" href="{{ route('rates.create') }}">Добавить тариф</a>
</div>

<table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Квартира</th>
            <th>Поставщик</th>
            <th>Услуга</th>
            <th>Цена</th>
            <th>Тип</th>
            <th>Дата начала</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        @foreach($rates as $rate)
        <tr>
            <td>{{ $rate->id }}</td>
            <td>{{ $rate->apartment->name }}</td>
            <td>{{ $rate->provider->name }}</td>
            <td>{{ $rate->service->name }}</td>
            <td>{{ $rate->price }} ₽</td>
            <td>{{ ucfirst($rate->type) }}</td>
            <td>{{ $rate->start_date->format('d.m.Y') }}</td>
            <td>
                <a class="btn btn-sm btn-info" href="{{ route('rates.show', $rate) }}">Просмотр</a>
                <a class="btn btn-sm btn-warning" href="{{ route('rates.edit', $rate) }}">Редактировать</a>
                <form action="{{ route('rates.destroy', $rate) }}" method="POST" class="d-inline">
                    @csrf
                    @method('DELETE')
                    <button class="btn btn-sm btn-danger" onclick="return confirm('Удалить тариф?')">Удалить</button>
                </form>
            </td>
        </tr>
        @endforeach
    </tbody>
</table>
@endsection
```

**`resources/views/rates/create.blade.php`** и **edit.blade.php** будут почти одинаковыми с полями select для квартиры, поставщика и услуги, полями price, type и start_date.

---

# **2. Charge (Начисления)**

### **ChargeController**

```php
<?php

namespace App\Http\Controllers;

use App\Models\Charge;
use App\Models\Apartment;
use App\Models\Service;
use Illuminate\Http\Request;

class ChargeController extends Controller
{
    public function index()
    {
        $charges = Charge::with(['apartment', 'service'])->get();
        return view('charges.index', compact('charges'));
    }

    public function create()
    {
        $apartments = Apartment::all();
        $services = Service::all();
        return view('charges.create', compact('apartments', 'services'));
    }

    public function store(Request $request)
    {
        $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'service_id' => 'required|exists:services,id',
            'amount' => 'required|numeric|min:0',
            'period' => 'required|date',
            'comment' => 'nullable|string|max:255',
        ]);

        Charge::create($request->all());
        return redirect()->route('charges.index')->with('success', 'Начисление добавлено');
    }

    public function edit(Charge $charge)
    {
        $apartments = Apartment::all();
        $services = Service::all();
        return view('charges.edit', compact('charge', 'apartments', 'services'));
    }

    public function update(Request $request, Charge $charge)
    {
        $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'service_id' => 'required|exists:services,id',
            'amount' => 'required|numeric|min:0',
            'period' => 'required|date',
            'comment' => 'nullable|string|max:255',
        ]);

        $charge->update($request->all());
        return redirect()->route('charges.index')->with('success', 'Начисление обновлено');
    }

    public function destroy(Charge $charge)
    {
        $charge->delete();
        return redirect()->route('charges.index')->with('success', 'Начисление удалено');
    }
}
```

---

# **3. Payment (Платежи)**

### **PaymentController**

```php
<?php

namespace App\Http\Controllers;

use App\Models\Payment;
use App\Models\Apartment;
use Illuminate\Http\Request;

class PaymentController extends Controller
{
    public function index()
    {
        $payments = Payment::with('apartment')->get();
        return view('payments.index', compact('payments'));
    }

    public function create()
    {
        $apartments = Apartment::all();
        return view('payments.create', compact('apartments'));
    }

    public function store(Request $request)
    {
        $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'amount' => 'required|numeric|min:0',
            'payment_date' => 'required|date',
            'comment' => 'nullable|string|max:255',
        ]);

        Payment::create($request->all());
        return redirect()->route('payments.index')->with('success', 'Платеж добавлен');
    }

    public function edit(Payment $payment)
    {
        $apartments = Apartment::all();
        return view('payments.edit', compact('payment', 'apartments'));
    }

    public function update(Request $request, Payment $payment)
    {
        $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'amount' => 'required|numeric|min:0',
            'payment_date' => 'required|date',
            'comment' => 'nullable|string|max:255',
        ]);

        $payment->update($request->all());
        return redirect()->route('payments.index')->with('success', 'Платеж обновлен');
    }

    public function destroy(Payment $payment)
    {
        $payment->delete();
        return redirect()->route('payments.index')->with('success', 'Платеж удален');
    }
}
```

---

# ✅ Что мы получаем

1. Полный CRUD для **тарифов, начислений и платежей**.
2. Связанные данные (квартира, услуга, поставщик) выводятся в таблицах.
3. Удобный интерфейс с Bootstrap для ПК.
4. Массовое заполнение безопасно через `$fillable` в моделях.

---

Если хочешь, следующим шагом я могу сделать **готовые Blade-шаблоны для Rates, Charges и Payments в стиле уже созданных квартир**, чтобы сразу всё выглядело единообразно и удобно.

Хочешь, чтобы я это сделал?

---

[Предыдущая часть](09.md) | [Содержание](01.md) | [Следующая часть](11md)



## –ö–Ω–æ–ø–∫–∞ ‚Äú–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Å –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞‚Äù

–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä üëç
**¬´–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Å –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞¬ª** ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ **–∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞** –¥–ª—è —Ç–∞–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–°–¥–µ–ª–∞–µ–º –∞–∫–∫—É—Ä–∞—Ç–Ω–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —É–¥–æ–±–Ω–æ.

---

## üéØ –ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (UX)

–ù–∞ —Ñ–æ—Ä–º–µ **–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π** –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞:

> üîÅ **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞**

–ß—Ç–æ –æ–Ω–∞ –¥–µ–ª–∞–µ—Ç:

1. –ë–µ—Ä—ë—Ç **–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —ç—Ç–æ–π –∂–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã** –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü
2. –ö–æ–ø–∏—Ä—É–µ—Ç:

    * —É—Å–ª—É–≥—É
    * —Å—É–º–º—É
3. –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç:

    * –≤—ã–±—Ä–∞–Ω–Ω—ã–π **–≥–æ–¥ + –º–µ—Å—è—Ü**
4. **–ù–µ –¥—É–±–ª–∏—Ä—É–µ—Ç**, –µ—Å–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞ —ç—Ç—É —É—Å–ª—É–≥—É —É–∂–µ –µ—Å—Ç—å

---

# üß© –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø–æ —à–∞–≥–∞–º)

---

## ‚úÖ –®–ê–ì 1. –ú–∞—Ä—à—Ä—É—Ç

`routes/web.php`

```php
Route::post(
    '/charges/copy-from-previous',
    [ChargeController::class, 'copyFromPrevious']
)->name('charges.copyFromPrevious');
```

---

## ‚úÖ –®–ê–ì 2. –ú–µ—Ç–æ–¥ –≤ ChargeController

```php
use Carbon\Carbon;
use App\Models\Charge;

public function copyFromPrevious(Request $request)
{
    $data = $request->validate([
        'apartment_id' => 'required|exists:apartments,id',
        'month'        => 'required|integer|min:1|max:12',
        'year'         => 'required|integer',
    ]);

    $currentPeriod = Carbon::create($data['year'], $data['month'], 1);
    $prevPeriod = $currentPeriod->copy()->subMonth();

    // –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞
    $previousCharges = Charge::where('apartment_id', $data['apartment_id'])
        ->whereDate('period', $prevPeriod)
        ->get();

    if ($previousCharges->isEmpty()) {
        return back()->with('warning', '–ù–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü');
    }

    // —É—Å–ª—É–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
    $existingServices = Charge::where('apartment_id', $data['apartment_id'])
        ->whereDate('period', $currentPeriod)
        ->pluck('service_id')
        ->toArray();

    $copied = 0;

    foreach ($previousCharges as $charge) {

        if (in_array($charge->service_id, $existingServices)) {
            continue;
        }

        Charge::create([
            'apartment_id' => $charge->apartment_id,
            'service_id'   => $charge->service_id,
            'amount'       => $charge->amount,
            'period'       => $currentPeriod,
        ]);

        $copied++;
    }

    return back()->with(
        'success',
        "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π: {$copied}"
    );
}
```

---

## ‚úÖ –®–ê–ì 3. –ö–Ω–æ–ø–∫–∞ –Ω–∞ —Ñ–æ—Ä–º–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π

–í `charges/create.blade.php` **–ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–æ–π**:

```blade
<form method="POST" action="{{ route('charges.copyFromPrevious') }}" class="mb-3">
    @csrf

    <input type="hidden" name="apartment_id"
           value="{{ old('apartment_id', $apartmentId ?? '') }}">

    <input type="hidden" name="month" value="{{ old('month', now()->month) }}">
    <input type="hidden" name="year"  value="{{ old('year', now()->year) }}">

    <button class="btn btn-outline-secondary"
            onclick="return confirm('–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Å –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞?')">
        üîÅ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞
    </button>
</form>
```

> ‚ö†Ô∏è –≤–∞–∂–Ω–æ: `apartment_id`, `month`, `year` **–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–µ**

---

## üß† –ù–µ–±–æ–ª—å—à–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ (–æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

### üîπ –û–±–Ω–æ–≤–ª—è—Ç—å hidden-–ø–æ–ª—è –ø—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Å—è—Ü–∞/–≥–æ–¥–∞

–î–æ–±–∞–≤—å JS –≤ —Ñ–æ—Ä–º—É:

```blade
<script>
document.addEventListener('change', function () {
    document.querySelector('input[name=month]').value =
        document.querySelector('select[name=month]').value;

    document.querySelector('input[name=year]').value =
        document.querySelector('select[name=year]').value;

    document.querySelector('input[name=apartment_id]').value =
        document.querySelector('select[name=apartment_id]').value;
});
</script>
```

---

# üéâ –ß—Ç–æ —Ç—ã –ø–æ–ª—É—á–∏–ª

‚úî –≤–≤–æ–¥ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –≤ **2 –∫–ª–∏–∫–∞**
‚úî –Ω–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤ –ø–µ—Ä–∏–æ–¥–∞—Ö
‚úî –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π
‚úî —Ä–µ–∞–ª—å–Ω—ã–π ‚Äú–±–∏–ª–ª–∏–Ω–≥-UX‚Äù
‚úî –≥–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üîú –ß—Ç–æ –¥–∞–ª—å—à–µ (–æ—á–µ–Ω—å –ª–æ–≥–∏—á–Ω–æ)

1Ô∏è‚É£ **–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (—Ç–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–∑—É –Ω–∞ –º–µ—Å—è—Ü)**
2Ô∏è‚É£ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã –ø–æ —É—Å–ª—É–≥–∞–º**
3Ô∏è‚É£ **–ü–ª–∞–Ω–æ–≤—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (—à–∞–±–ª–æ–Ω—ã)**
4Ô∏è‚É£ **–ê–≤—Ç–æ–∑–∞—á—ë—Ç –ø–ª–∞—Ç–µ–∂–µ–π**

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –ø–æ–π–¥—ë–º –¥–∞–ª—å—à–µ.
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –Ω–æ–º–µ—Ä üëå

---

[–ü—Ä–µ–¥—ã–¥—É—â–∞—è —á–∞—Å—Ç—å](35.md) | [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](01.md) | [–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å](37.md)



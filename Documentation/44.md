## –î–µ–ª–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –∫–≤–∏—Ç–∞–Ω—Ü–∏–π

–û—Ç–ª–∏—á–Ω–æ, –¥–µ–ª–∞–µ–º üëç
–ù–∏–∂–µ ‚Äî **—á–∏—Å—Ç—ã–π, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π `ReceiptController`**, —Å—Ä–∞–∑—É –ø–æ–¥ —Ç–≤–æ–π —Ç–µ–∫—É—â–∏–π UX (modal –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã).

---

# üßæ `ReceiptController`

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

* –∑–∞–≥—Ä—É–∑–∫—É PDF-–∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
* –ø—Ä–∏–≤—è–∑–∫—É –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º
* —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ –∫–≤–∞—Ä—Ç–∏—Ä–µ / –≥–æ–¥—É / –º–µ—Å—è—Ü—É
* —É–¥–∞–ª–µ–Ω–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π

---

## 1Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

```bash
php artisan make:controller ReceiptController
```

---

## 2Ô∏è‚É£ –ü–æ–ª–Ω—ã–π –∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

```php
<?php

namespace App\Http\Controllers;

use App\Models\Receipt;
use App\Models\Charge;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;
use Carbon\Carbon;

class ReceiptController extends Controller
{
    /**
     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
     */
    public function store(Request $request)
    {
        $data = $request->validate([
            'apartment_id' => 'required|exists:apartments,id',
            'month'        => 'required|integer|min:1|max:12',
            'year'         => 'required|integer|min:2000|max:2100',
            'file'         => 'required|file|mimes:pdf|max:10240',
            'charges'      => 'nullable|array',
            'charges.*'    => 'exists:charges,id',
        ]);

        // –ü–µ—Ä–∏–æ–¥ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ (1-–µ —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞)
        $period = Carbon::create($data['year'], $data['month'], 1);

        // –ü–∞–ø–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è
        $directory = sprintf(
            'receipts/%d/%d/%02d',
            $data['apartment_id'],
            $period->year,
            $period->month
        );

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
        $file = $request->file('file');

        $path = $file->store($directory, 'public');

        // –°–æ–∑–¥–∞—ë–º –∫–≤–∏—Ç–∞–Ω—Ü–∏—é
        $receipt = Receipt::create([
            'apartment_id'  => $data['apartment_id'],
            'period'        => $period,
            'file_path'     => $path,
            'original_name' => $file->getClientOriginalName(),
        ]);

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã)
        if (!empty($data['charges'])) {
            $receipt->charges()->sync($data['charges']);
        }

        return back()->with('success', '–ö–≤–∏—Ç–∞–Ω—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    }

    /**
     * –£–¥–∞–ª–µ–Ω–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
     */
    public function destroy(Receipt $receipt)
    {
        // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
        if ($receipt->file_path) {
            Storage::disk('public')->delete($receipt->file_path);
        }

        // –û—Ç–≤—è–∑—ã–≤–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å
        $receipt->charges()->detach();
        $receipt->delete();

        return back()->with('success', '–ö–≤–∏—Ç–∞–Ω—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞');
    }

    /**
     * –°–∫–∞—á–∞—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é
     */
    public function download(Receipt $receipt)
    {
        return Storage::disk('public')->download(
            $receipt->file_path,
            $receipt->original_name ?? 'receipt.pdf'
        );
    }
}
```

---

## 3Ô∏è‚É£ –†–æ—É—Ç—ã

`routes/web.php`

```php
use App\Http\Controllers\ReceiptController;

Route::post('/receipts', [ReceiptController::class, 'store'])
    ->name('receipts.store');

Route::delete('/receipts/{receipt}', [ReceiptController::class, 'destroy'])
    ->name('receipts.destroy');

Route::get('/receipts/{receipt}/download', [ReceiptController::class, 'download'])
    ->name('receipts.download');
```

---

## 4Ô∏è‚É£ –ß—Ç–æ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

‚úî –∑–∞–≥—Ä—É–∑–∫–∞ PDF
‚úî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ –∫–≤–∞—Ä—Ç–∏—Ä–µ / –≥–æ–¥—É / –º–µ—Å—è—Ü—É
‚úî –æ–¥–Ω–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏—è ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
‚úî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
‚úî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º

---

## 5Ô∏è‚É£ –ß—Ç–æ –º—ã –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏–º –¥–∞–ª—å—à–µ (–æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ)

1Ô∏è‚É£ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏** (–∑–∞–º–µ–Ω–∞ PDF / –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π)
2Ô∏è‚É£ **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã**
3Ô∏è‚É£ **–§–∏–ª—å—Ç—Ä –∫–≤–∏—Ç–∞–Ω—Ü–∏–π –ø–æ –≥–æ–¥—É**
4Ô∏è‚É£ **Drag & Drop –∑–∞–≥—Ä—É–∑–∫–∞**
5Ô∏è‚É£ **–ê–≤—Ç–æ–ø—Ä–∏–≤—è–∑–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –ø–æ –º–µ—Å—è—Ü—É**

---

### üëâ –°–ª–µ–¥—É—é—â–∏–π –ª–æ–≥–∏—á–Ω—ã–π —à–∞–≥

–†–µ–∫–æ–º–µ–Ω–¥—É—é —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞—Ç—å:

**¬´–°–ø–∏—Å–æ–∫ –∫–≤–∏—Ç–∞–Ω—Ü–∏–π –≤–æ –≤–∫–ª–∞–¥–∫–µ ‚Äú–ù–∞—á–∏—Å–ª–µ–Ω–∏—è‚Äù¬ª**
‚Äî —Å –∏–∫–æ–Ω–∫–∞–º–∏ üìÑ, ‚¨á, üóë

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —Å–∫–∞–∂–∏, —Å–¥–µ–ª–∞–µ–º üëå

---

[–ü—Ä–µ–¥—ã–¥—É—â–∞—è —á–∞—Å—Ç—å](43.md) | [–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ](01.md) | [–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å](45.md)


